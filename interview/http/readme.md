## HTTP 发展

- HTTP/0.9   传输体积很小的 HTML 文件
    1991年提出   网络之间传递HTML超文本的内容 —— 超文本传输协议
    请求流程：
      1. 基于TCP协议。  客户端先根据IP地址、端口和服务器建立的TCP连接  TCP协议三次握手
      2. 建立好连接后，发送一个GET请求行的信息，如 GET / index.html 用来获取index.html。
      3. 服务器接收请求信息后，读取对应的HTML文件，并将数据以ASCII字符流返回给客户端。
      4. HTML 文档传输完成后，断开连接。
    特点：
      1. 只有一个请求行，并没有 HTTP 请求头和请求体，因为只需要一个请求行就可以完整表达客户端的需求了。
      2. 服务器也没有返回头信息，这是因为服务器端并不需要告诉客户端太多信息，只需要返回数据就可以了。
      3. 返回的文件内容是以 ASCII 字符流来传输的，因为都是 HTML 格式的文件，所以使用 ASCII 字节码来传输是最合适的。

- HTTP/1.0
    原因：浏览器展示的不单是HTML文件，还包括 Javascript、CSS、图片、音频、视频等不同类型的文件
    # 核心诉求：支持多种类型的文件下载。且文件格式不仅局限与ASCII编码。
    - 如何实现多种类型文件的下载？
        引入了请求体和响应头
    - HTTP/1.0 是怎么通过请求头和响应头来支持多种不同类型的数据？
        HTTP/1.0 的方案是通过请求头和响应头来进行协商，在发起请求时候会通过 HTTP 请求头告诉服务器它期待服务器返回什么类型的文件、采取什么形式的压缩、提供什么语言的文件以及文件的具体编码。
    请求头：
        accept: text/html                   // 文件类型
        accept-encoding: gzip, deflate, br  // 压缩方式
        accept-Charset: ISO-8859-1,utf-8    // 文件编码
        accept-language: zh-CN,zh           // 优先的语言
    响应头：
        content-encoding: br                // 压缩方式
        content-type: text/html; charset=UTF-8 // 文件类型 文件编码
    - 新增特性：
        1. 状态码
        2. Cache 机制   缓存已下载过的数据
        3. 请求头加入了 用户代理 字段
- HTTP/1.1
    - 改进持久连接  如图 http1.1.png
        特点：在一个 TCP 连接上可以传输多个 HTTP 请求，只要浏览器或者服务器没有明确断开连接，那么该 TCP 连接会一直保持。
        不想要采用持久连接，可以在 HTTP 请求头中加上Connection: close。
    存在队头阻塞的问题。
    - 管线化技术  试图解决对头阻塞
        HTTP/1.1 中的管线化是指将多个 HTTP 请求整批提交给服务器的技术。
    - 提供虚拟主机的支持
        在 HTTP/1.0 中，每个域名绑定了一个唯一的 IP 地址，因此一个服务器只能支持一个域名。
        HTTP/1.1  实现在一台物理主机上绑定多个虚拟主机，每个虚拟主机都有自己的单独的域名，这些单独的域名都公用同一个 IP 地址。
    - 对动态生成的内容提供了完美支持
        引入 Chunk transfer 机制
            服务器会将数据分割成若干个任意大小的数据块，每个数据块发送时会附上上个数据块的长度，最后使用一个零长度的块作为发送数据完成的标志。
    - 客户端 Cookie、安全机制
    # 核心：1.增加了持久连接；2.浏览器为每个域名最多同时维护 6 个 TCP 持久连接；3.使用 CDN 的实现域名分片机制。
    提高了页面的下载速度
    - 存在的主要问题
        对带宽的利用率却并不理想
        原因：
          1. TCP 的慢启动。一个 TCP 连接建立之后，就进入了发送数据状态，刚开始 TCP 协议会采用一个非常慢的速度去发送数据，然后慢慢加快发送数据的速度，直到发送数据的速度达到一个理想状态。
          2. 同时开启了多条 TCP 连接，那么这些连接会竞争固定的带宽。
          3. HTTP/1.1 队头阻塞的问题。
- HTTP/2.0
    解决HTTP/1.1问题方案：一个域名只使用一个 TCP 长连接和消除队头阻塞问题。
    # 多路复用机制   引入二进制分帧层
    如图 http2.0.png
      1. 浏览器准备好请求数据，包括了请求行、请求头等信息，如果是 POST 方法，那么还要有请求体。
      2. 这些数据经过二进制分帧层处理之后，会被转换为一个个带有请求 ID 编号的帧，通过协议栈将这些帧发送给服务器。
      3. 服务器接收到所有帧之后，会将所有相同 ID 的帧合并为一条完整的请求信息。
      4. 然后服务器处理该条请求，并将处理的响应行、响应头和响应体分别发送至二进制分帧层。
      5. 同样，二进制分帧层会将这些响应数据转换为一个个带有请求 ID 编号的帧，经过协议栈发送给浏览器。
      6. 浏览器接收到响应帧之后，会根据 ID 编号将帧的数据提交给对应的请求。
    - 其他新特性
        1. 可以设置请求的优先级   重要数据能及时送达浏览器。
        2. 服务器推送        直接将数据提前推送到浏览器。
        3. 头部压缩          大幅提升传输效率。